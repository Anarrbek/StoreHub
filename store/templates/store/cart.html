{% extends 'base.html' %}

{% block content %}
<div class="container" style="max-width:1000px">
  <div style="margin-bottom:40px">
    <h1 style="margin:0 0 8px 0; font-size:2rem; font-weight:700">–ö–æ—Ä–∑–∏–Ω–∞</h1>
    <p style="color:var(--muted); margin:0">{% if items %}{{ items|length }} —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ{% else %}–ü—É—Å—Ç–æ{% endif %}</p>
  </div>

  {% if items %}
    <div style="display:grid; grid-template-columns:1fr 350px; gap:30px">
      <!-- –¢–æ–≤–∞—Ä—ã -->
      <div style="background:var(--light); border-radius:12px; padding:24px; border:1px solid var(--border)">
        {% for it in items %}
          <div style="display:flex; gap:16px; padding:16px 0; border-bottom:1px solid var(--border)">
            {% if it.product and it.product.image %}
              <a href="{% url 'product_detail' it.product.slug %}" style="text-decoration:none">
                <img src="{{ it.product.image.url }}" alt="{{ it.product.name }}" style="width:100px; height:100px; object-fit:cover; border-radius:8px">
              </a>
            {% else %}
              <div style="width:100px; height:100px; background:var(--border); border-radius:8px"></div>
            {% endif %}

            <div style="flex:1">
              {% if it.product %}
                <a href="{% url 'product_detail' it.product.slug %}" style="text-decoration:none; color:inherit">
                  <h3 style="margin:0 0 4px 0; font-weight:600">{{ it.product.name }}</h3>
                </a>
              {% else %}
                <h3 style="margin:0 0 4px 0; font-weight:600; color:var(--muted)">–¢–æ–≤–∞—Ä (—É–¥–∞–ª—ë–Ω)</h3>
              {% endif %}

              {% if not it.is_deleted_backup %}
                <div style="display:flex; gap:8px; align-items:center; margin:8px 0">
                  <form action="{% url 'cart_update' it.id %}" method="post">
                    {% csrf_token %}
                    <input type="number" name="quantity" value="{{ it.quantity }}" min="1" style="width:60px; padding:6px 8px; border:1px solid var(--border); border-radius:6px; background:var(--light); color:var(--text); font-size:0.9rem">
                  </form>
                </div>
              {% else %}
                <div style="color:var(--muted); font-size:0.85rem; margin:8px 0">–¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω –∏–ª–∏ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω</div>
              {% endif %}

              <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px">
                <span style="font-weight:700; font-size:1.1rem">{{ it.subtotal }} ‚ÇΩ</span>
                {% if it.is_deleted_backup %}
                  <form method="post" action="{% url 'cart_restore' it.id %}">
                    {% csrf_token %}
                    <button type="submit" style="padding:6px 12px; background:var(--primary); color:var(--dark); border:none; border-radius:6px; font-weight:600; cursor:pointer; font-size:0.85rem">
                      –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    </button>
                  </form>
                {% else %}
                  <form method="post" action="{% url 'cart_remove' it.id %}}" style="display:inline">
                    {% csrf_token %}
                    <button type="submit" style="color:#d32f2f; text-decoration:none; font-size:0.9rem; font-weight:600; background:none; border:none; cursor:pointer">
                      –£–¥–∞–ª–∏—Ç—å
                    </button>
                  </form>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- –ò—Ç–æ–≥–æ -->
      <div style="background:var(--light); border-radius:12px; padding:24px; border:1px solid var(--border); height:fit-content; position:sticky; top:20px">
        <h2 style="margin:0 0 20px 0; font-size:1.1rem; font-weight:700">–ò—Ç–æ–≥–æ</h2>

        <div style="background:rgba(255, 204, 0, 0.1); padding:16px; border-radius:8px; margin-bottom:20px">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <span style="color:var(--muted)">–ö –æ–ø–ª–∞—Ç–µ:</span>
            <span style="font-weight:700; font-size:1.3rem; color:var(--primary)">{{ total }} ‚ÇΩ</span>
          </div>
        </div>

        {% if has_purchasable %}
          <form method="post" action="{% url 'checkout' %}" style="margin-bottom:12px">
            {% csrf_token %}
            <button type="submit" style="width:100%; padding:14px; background:var(--primary); color:var(--dark); border:none; border-radius:8px; font-weight:700; font-size:1rem; cursor:pointer">
              –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
          </form>
        {% else %}
          <div style="padding:12px; background:#f2dede; color:#a94442; border-radius:6px; font-size:0.85rem; margin-bottom:12px; text-align:center">
            –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∑–∞–∫–∞–∑–∞
          </div>
        {% endif %}

        <a href="{% url 'product_list' %}" style="display:block; padding:12px; border:1px solid var(--border); border-radius:8px; text-decoration:none; color:var(--text); font-weight:600; text-align:center">
          ‚Üê –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
        </a>
      </div>
    </div>

  {% else %}
    <div style="background:var(--light); border-radius:12px; padding:60px 24px; border:1px solid var(--border); text-align:center">
      <div style="font-size:3rem; margin-bottom:16px">üõí</div>
      <h2 style="margin:0 0 8px 0; font-size:1.5rem; font-weight:700">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
      <p style="color:var(--muted); margin:0 0 24px 0">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É</p>
      <a href="{% url 'product_list' %}" style="display:inline-block; padding:14px 28px; background:var(--primary); color:var(--dark); text-decoration:none; border-radius:8px; font-weight:700">
        –°–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥
      </a>
    </div>
  {% endif %}
</div>

<style>
  @media (max-width: 768px) {
    [style*="grid-template-columns:1fr 350px"] {
      grid-template-columns: 1fr;
    }

    [style*="position:sticky"] {
      position: relative;
    }
  }
</style>
{% endblock %}
