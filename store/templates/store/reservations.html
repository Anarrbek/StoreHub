{% extends 'base.html' %}

{% block content %}
<div class="container" style="max-width:1200px">
  <div style="margin-bottom:40px">
    <h1 style="margin:0 0 8px 0; font-size:2rem; font-weight:700">–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h1>
    <p style="color:var(--muted); margin:0">{% if reservations %}{{ reservations|length }} –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π{% else %}–ü—É—Å—Ç–æ{% endif %}</p>
  </div>

  {% if reservations %}
    <div class="products-grid">
      {% for r in reservations %}
        <div class="product-card">
          <div class="product-image">
            {% if r.product.image %}
              <a href="{% url 'product_detail' slug=r.product.slug %}" style="text-decoration:none">
                <img src="{{ r.product.image.url }}" alt="{{ r.product.name }}" loading="lazy">
              </a>
            {% else %}
              <a href="{% url 'product_detail' slug=r.product.slug %}" style="color:var(--muted); text-decoration:none">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</a>
            {% endif %}
            <div style="position:absolute; top:8px; right:8px; background:rgba(255,152,0,0.9); color:white; padding:6px 12px; border-radius:6px; font-size:0.8rem; font-weight:600">
              üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ
            </div>
          </div>
          
          <div class="product-info">
            <div class="product-rating">
              <span class="star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
            </div>
            
            <a href="{% url 'product_detail' slug=r.product.slug %}" class="product-name" style="text-decoration:none; color:inherit">
              {% if language == 'kg' and r.product.name_kg %}{{ r.product.name_kg }}{% elif language == 'ru' and r.product.name_ru %}{{ r.product.name_ru }}{% elif language == 'en' and r.product.name_en %}{{ r.product.name_en }}{% else %}{{ r.product.name }}{% endif %}
            </a>
            
            <div style="color:var(--muted); font-size:0.85rem; margin:4px 0">
              {% if r.product.category %}{{ r.product.category.name }}{% endif %}
            </div>
            
            <div class="product-price">{{ r.product.price }} ‚ÇΩ</div>
            
            <div style="color:var(--muted); font-size:0.85rem; margin:8px 0; padding:8px; background:var(--light); border-radius:6px">
              <div style="margin-bottom:4px"><strong>{{ r.reserved_from }}</strong></div>
              <div>‚Äî</div>
              <div style="margin-top:4px"><strong>{{ r.reserved_to }}</strong></div>
            </div>
            
            <form method="post" action="{% url 'cancel_reservation' r.id %}" style="width:100%">
              {% csrf_token %}
              <button type="submit" style="width:100%; padding:10px; background:#ff6b6b; color:white; border:none; border-radius:6px; font-weight:600; cursor:pointer; font-size:0.9rem">
                ‚úï –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å
              </button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ -->
    <div style="background:linear-gradient(135deg, #FFCC00 0%, #FFB800 100%); padding:24px; border-radius:12px; margin-top:40px; text-align:right">
      <div style="color:var(--dark); font-size:0.9rem; margin-bottom:8px">
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: <strong>{{ reservations|length }}</strong>
      </div>
      <div style="font-size:2rem; font-weight:700; color:var(--dark)">
        –û–±—â–∞—è —Å—É–º–º–∞: <strong>{{ total_price }} ‚ÇΩ</strong>
      </div>
    </div>
  {% else %}
    <div style="background:var(--light); border-radius:12px; padding:60px 24px; border:1px solid var(--border); text-align:center">
      <div style="font-size:3rem; margin-bottom:16px">üìÖ</div>
      <h2 style="margin:0 0 8px 0; font-size:1.5rem; font-weight:700">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h2>
      <p style="color:var(--muted); margin:0 0 24px 0">–ó–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ —Ç–æ–≤–∞—Ä—ã, —á—Ç–æ–±—ã –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∑–∏–ª–∏—Å—å –∑–¥–µ—Å—å</p>
      <a href="{% url 'product_list' %}" style="display:inline-block; padding:14px 28px; background:var(--primary); color:var(--dark); text-decoration:none; border-radius:8px; font-weight:700">
        –°–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}